"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ButtonWithoutAnalytics = exports.ButtonBase = exports.defaultProps = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _analyticsNext = require("@atlaskit/analytics-next");

var _withDeprecationWarnings = _interopRequireDefault(require("./withDeprecationWarnings"));

var _getButtonProps = _interopRequireDefault(require("./getButtonProps"));

var _CustomComponentProxy = _interopRequireDefault(require("./CustomComponentProxy"));

var _getButtonStyles = _interopRequireDefault(require("../styled/getButtonStyles"));

var _ButtonContent = _interopRequireDefault(require("../styled/ButtonContent"));

var _ButtonWrapper = _interopRequireDefault(require("../styled/ButtonWrapper"));

var _IconWrapper = _interopRequireDefault(require("../styled/IconWrapper"));

var _LoadingSpinner = _interopRequireDefault(require("../styled/LoadingSpinner"));

var _require = require('../../package.json'),
    packageName = _require.name,
    packageVersion = _require.version;

var StyledButton = _styledComponents.default.button.withConfig({
  displayName: "Button__StyledButton",
  componentId: "sc-1o41kgk-0"
})(["\n  ", ";\n"], _getButtonStyles.default);

StyledButton.displayName = 'StyledButton'; // Target the <a> here to override a:hover specificity.

var StyledLink = _styledComponents.default.a.withConfig({
  displayName: "Button__StyledLink",
  componentId: "sc-1o41kgk-1"
})(["\n  a& {\n    ", ";\n  }\n"], _getButtonStyles.default);

StyledLink.displayName = 'StyledLink';

var StyledSpan = _styledComponents.default.span.withConfig({
  displayName: "Button__StyledSpan",
  componentId: "sc-1o41kgk-2"
})(["\n  ", ";\n"], _getButtonStyles.default);

StyledSpan.displayName = 'StyledSpan';

var createStyledComponent = function createStyledComponent() {
  // Override pseudo-state specificity.
  // This is necessary because we don't know what DOM element the custom component will render.
  var component = (0, _styledComponents.default)(_CustomComponentProxy.default).withConfig({
    displayName: "Button__component",
    componentId: "sc-1o41kgk-3"
  })(["&,a&,&:hover,&:active,&:focus{", "}"], _getButtonStyles.default);
  component.displayName = 'StyledCustomComponent';
  return component;
};

var defaultProps = {
  appearance: 'default',
  isDisabled: false,
  isSelected: false,
  isLoading: false,
  spacing: 'default',
  type: 'button',
  shouldFitContainer: false,
  autoFocus: false
};
exports.defaultProps = defaultProps;

var Button =
/*#__PURE__*/
function (_Component) {
  (0, _inherits2.default)(Button, _Component);

  function Button() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2.default)(this, Button);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(Button)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "button", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "state", {
      isActive: false,
      isFocus: false,
      isHover: false
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "customComponent", null);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "isInteractive", function () {
      return !_this.props.isDisabled && !_this.props.isLoading;
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onMouseEnter", function () {
      _this.setState({
        isHover: true
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onMouseLeave", function () {
      return _this.setState({
        isHover: false,
        isActive: false
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onMouseDown", function (e) {
      e.preventDefault();

      _this.setState({
        isActive: true
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onMouseUp", function () {
      return _this.setState({
        isActive: false
      });
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onFocus", function (event) {
      _this.setState({
        isFocus: true
      });

      if (_this.props.onFocus) {
        _this.props.onFocus(event);
      }
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onBlur", function (event) {
      _this.setState({
        isFocus: false
      });

      if (_this.props.onBlur) {
        _this.props.onBlur(event);
      }
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "onInnerClick", function (e) {
      if (!_this.isInteractive()) {
        e.stopPropagation();
      }

      return true;
    });
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)((0, _assertThisInitialized2.default)(_this)), "getInnerRef", function (ref) {
      _this.button = ref;
      if (_this.props.innerRef) _this.props.innerRef(ref);
    });
    return _this;
  }

  (0, _createClass2.default)(Button, [{
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(nextProps) {
      if (this.props.component !== nextProps.component) {
        delete this.customComponent;
      }
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      if (this.props.autoFocus && this.button) {
        this.button.focus();
      }
    }
  }, {
    key: "getStyledComponent",
    value: function getStyledComponent() {
      if (this.props.component) {
        if (!this.customComponent) {
          this.customComponent = createStyledComponent();
        }

        return this.customComponent;
      }

      if (this.props.href) {
        return this.props.isDisabled ? StyledSpan : StyledLink;
      }

      return StyledButton;
    }
  }, {
    key: "render",
    value: function render() {
      var _this$props = this.props,
          children = _this$props.children,
          iconBefore = _this$props.iconBefore,
          iconAfter = _this$props.iconAfter,
          isLoading = _this$props.isLoading,
          shouldFitContainer = _this$props.shouldFitContainer,
          spacing = _this$props.spacing,
          appearance = _this$props.appearance,
          isSelected = _this$props.isSelected,
          isDisabled = _this$props.isDisabled; // $FlowFixMe - Cannot call `getButtonProps` with `this` bound to `component` because `Button` [1] is incompatible with `Button` [2].

      var buttonProps = (0, _getButtonProps.default)(this);
      var StyledComponent = this.getStyledComponent();
      var iconIsOnlyChild = !!(iconBefore && !iconAfter && !children || iconAfter && !iconBefore && !children);
      return _react.default.createElement(StyledComponent, (0, _extends2.default)({
        innerRef: this.getInnerRef
      }, buttonProps), _react.default.createElement(_ButtonWrapper.default, {
        onClick: this.onInnerClick,
        fit: !!shouldFitContainer
      }, isLoading ? _react.default.createElement(_LoadingSpinner.default, {
        spacing: spacing,
        appearance: appearance,
        isSelected: isSelected,
        isDisabled: isDisabled
      }) : null, iconBefore ? _react.default.createElement(_IconWrapper.default, {
        isLoading: isLoading,
        spacing: buttonProps.spacing,
        isOnlyChild: iconIsOnlyChild
      }, iconBefore) : null, children ? _react.default.createElement(_ButtonContent.default, {
        isLoading: isLoading,
        followsIcon: !!iconBefore,
        spacing: buttonProps.spacing
      }, children) : null, iconAfter ? _react.default.createElement(_IconWrapper.default, {
        isLoading: isLoading,
        spacing: buttonProps.spacing,
        isOnlyChild: iconIsOnlyChild
      }, iconAfter) : null));
    }
  }]);
  return Button;
}(_react.Component);

(0, _defineProperty2.default)(Button, "defaultProps", defaultProps);
var ButtonBase = Button;
exports.ButtonBase = ButtonBase;
var ButtonWithoutAnalytics = (0, _withDeprecationWarnings.default)(Button);
exports.ButtonWithoutAnalytics = ButtonWithoutAnalytics;
var createAndFireEventOnAtlaskit = (0, _analyticsNext.createAndFireEvent)('atlaskit');

var _default = (0, _analyticsNext.withAnalyticsContext)({
  componentName: 'button',
  packageName: packageName,
  packageVersion: packageVersion
})((0, _analyticsNext.withAnalyticsEvents)({
  onClick: createAndFireEventOnAtlaskit({
    action: 'clicked',
    actionSubject: 'button',
    attributes: {
      componentName: 'button',
      packageName: packageName,
      packageVersion: packageVersion
    }
  })
})(ButtonWithoutAnalytics));

exports.default = _default;